import e,{useCallback as t,useContext as n,useRef as r,useEffect as o,useState as i}from"react";import a from"prop-types";import{Button as l,Card as s,CardBody as c,CardFooter as u,CardHeader as d,Dropdown as f,DropdownToggle as p,DropdownMenu as g,DropdownItem as m,Table as y}from"reactstrap";import v from"classnames";import{Modifier as b,EditorState as k,CompositeDecorator as T,ContentState as C,convertFromRaw as S,convertToRaw as E,RichUtils as w,AtomicBlockUtils as I,SelectionState as N,Editor as x}from"draft-js";import{TextEditorContext as F}from"components/TextEditor/Context";import O from"assets/img/default-avatar.png";function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},L.apply(this,arguments)}function D(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function P(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t.indexOf(n=i[r])>=0||(o[n]=e[n]);return o}Object.assign({leftIcon:"",rightIcon:""},l.prototype.props);var j=function(e){return h(l,e,e.leftIcon?h("i",{className:v(e.leftIcon,"me-2")}):null,e.children,e.rightIcon?h("i",{className:v(e.rightIcon,"ms-2")}):null)};j.propTypes=L({leftIcon:a.string,rightIcon:a.string},l.propTypes&&l.propTypes),Object.assign({},s.prototype.props);var R=function(e){return h(s,e,e.children)};R.propTypes=L({},s.propTypes&&s.propTypes),Object.assign({},c.prototype.props);var A=function(e){return h(c,e,e.children)};A.propTypes=L({},c.propTypes&&c.propTypes),Object.assign({},u.prototype.props);var M=function(e){return h(u,e,e.children)};M.propTypes=L({},u.propTypes&&u.propTypes),Object.assign({},d.prototype.props);var z=function(e){return h(d,e,e.children)};z.propTypes=L({},d.propTypes&&d.propTypes),Object.assign({},f.prototype.props);var U=function(e){var t=L({},(D(e),e));return h(f,t,t.children)};U.propTypes=L({},f.propTypes&&f.propTypes);var B=["caret"];Object.assign({startIcon:"",endIcon:"",caret:!0},p.prototype.props);var K=function(e){var t=P(e,B);return h(Fragment,null,h(p,L({caret:!t.startIcon&&!t.endIcon&&t.caret},t),t.startIcon&&h("i",{className:v(t.startIcon,"me-2")}),t.children,t.endIcon&&h("i",{className:v(t.endIcon,"ms-2")})))};K.propTypes=L({startIcon:a.string,endIcon:a.string,caret:a.bool},p.propTypes&&p.propTypes),Object.assign({},g.prototype.props);var _=function(e){var t=L({},(D(e),e));return h(g,t,t.children)};_.propTypes=L({},g.propTypes&&g.propTypes);var q=["leftIcon","rightIcon","leftIconStyle","rightIconStyle"];Object.assign({},m.prototype.props);var G=function(e){var t=e.leftIcon,n=void 0===t?"":t,r=e.rightIcon,o=void 0===r?"":r,i=e.leftIconStyle,a=void 0===i?"text-secondary":i,l=e.rightIconStyle,s=void 0===l?"text-secondary":l,c=P(e,q);return h(m,L({},c,{className:"d-flex justify-content-between align-items-center"}),h("span",null,n&&h("i",{className:n+" "+a+" me-2"}),c.children),o&&h("i",{className:o+" "+s}))};G.propTypes=L({},m.propTypes&&m.propTypes);var H=function(e){return h(y,{striped:!0,hover:!0},h("thead",null,h("tr",null,e.thead.map(function(t,n){return h("th",{className:v("",{"text-right":e.thead.length-1===n}),key:n},t.text)}))),h("tbody",null,e.tbody.map(function(e,t){var n;return h("tr",{className:v((n={},n[e.className]=void 0!==e.className,n)),key:t},e.data.map(function(e,t){var n;return h("td",{className:v((n={},n[e.className]=void 0!==e.className,n)),key:t},e.item)}),e.actions&&h("td",{className:"text-right"},e.actions))})))};H.propTypes={thead:a.arrayOf(a.shape({className:a.string,text:a.string.isRequired})).isRequired,tbody:a.arrayOf(a.shape({className:a.string,data:a.arrayOf(a.shape({className:a.string,item:a.oneOfType([a.string,a.number,a.node]).isRequired})).isRequired,actions:a.node})).isRequired};var Y="inline-default",J="block-default",W="atomic-entity",Z="image",V="divider",X="link",Q="mention",$="checklist",ee="start";function te(e){var n=e.name,r=e.profileImageUrl,o=e._id,i=e.onSelect,a=void 0===i?function(){}:i,l=t(function(e){e.preventDefault(),a({name:n,profileImageUrl:r,_id:o})});return h("div",{className:"d-flex align-items-center"},h("div",{className:"avatar mb-1"},h("img",{src:r||O,alt:n})),h("div",{onClick:l,className:"btn btn-link p-2 mb-1"},n))}var ne=["suggestions"];function re(e){var t=e.suggestions,r=P(e,ne),o=n(F);return h(Fragment,null,t.length?h("div",{className:"mention-suggestions position-absolute mt-4 p-2 shadow-md",style:L({},o.computedPosForMentionSuggestions)},t.map(function(e,t){return h(te,L({key:e.name+t},e,r))})):null)}function oe(e,t,n){for(var r,o,i=t.getText();null!==(r=e.exec(i));)n(o=r.index,o+r[0].length)}var ie=/\B@\w+/g,ae=/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g,le=new T([{strategy:function(e,t,n){oe(ie,e,t)},component:function(e){var i=r(null),a=n(ce),l=a.editorRef,s=a.mentionSuggestions,c=a.updateComputedPosForMentionSuggestions,u=a.handleMentionSelect,d=t(function(){var e,t;return{left:(null==(e=l.current)||null==(t=e.editor)?void 0:t.getBoundingClientRect()).width-i.current.offsetLeft<240?i.current.offsetLeft-230:i.current.offsetLeft,top:i.current.offsetTop,display:"block"}},[]),f=t(function(){return{display:"none"}},[]);function p(){if(!e.entityKey)return null;var t=e.contentState.getEntity(e.entityKey);return L({},null==t?void 0:t.getData())}return o(function(){i.current&&c(d())},[]),h(Fragment,null,p()?h("a",{href:"/admin/users/"+p()._id,className:"text-primary"},p().name):h("span",{ref:i,className:""},e.children),h(re,{suggestions:s.filter(function(t){var n;return t.name.toLowerCase().includes(e.decoratedText.slice(1,null==e||null==(n=e.decoratedText)?void 0:n.length).toLowerCase())}),onSelect:function(t){var n=t.name,r=t.profileImageUrl,o=t._id,i="@"+n.split(" ").join("_");u(e.contentState,e.blockKey,{start:e.start,end:e.end},{mention:i+" ",profileImageUrl:r,_id:o,name:n}),c(f())}}))}},{strategy:function(e,t,n){oe(ae,e,t)},component:function(e){return h("a",{href:e.decoratedText,title:e.decoratedText,target:"_blank",rel:"noreferrer"},e.children)}},{strategy:function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&n.getEntity(t).getType()===X},t)},component:function(e){var t=e.contentState.getEntity(e.entityKey).getData();return t.href?h("a",{href:t.href,title:t.linkText,target:"_blank",rel:"noreferrer"},t.linkText||t.href):null}}]),se=["children"],ce=e.createContext(),ue=function(t){var n=t.children,r=P(t,se),o=function(t){var n,r,o=e.useRef(null),a=e.useState(k.createEmpty(le)),l=a[0],s=a[1],c=i(!1),u=c[0],d=c[1],f=e.useState({display:"none"}),p=f[0],h=f[1];e.useEffect(function(){var e;try{"string"==typeof t.value&&(e=JSON.parse(t.value)),"object"==typeof t.value&&(e=t.value)}catch(e){if(console.log(e),"string"==typeof t.value)return y(k.createWithContent(C.createFromText(t.value)))}return y(t.value||e?k.set(l,{currentContent:S(e),directionMap:k.createWithContent(S(e)).getDirectionMap()}):k.createEmpty(le))},[t.value]);var g=e.useRef(null),m=function(e,t){var n=l.getCurrentContent().createEntity(e,"IMMUTABLE",L({},t)),r=n.getLastCreatedEntityKey(),o=k.set(l,{currentContent:n},"create-entity");y(I.insertAtomicBlock(o,r," "))},y=function(e){var n=e.getCurrentContent();s(e),t.onDataStructureChange(JSON.stringify(E(n)))},v=function(e){try{if(!t.handleUpload)return Promise.resolve(console.log("Uploader function not specified"));var n=e.every(function(e){return"image"===e.type.split("/")[0]});return Promise.resolve(n?function(n,r){try{var o=Promise.resolve(Promise.all(e.map(function(e){return t.handleUpload(e)}))).then(function(e){console.log(e),e.every(function(e){return e})||console.log("one or mutiple files don't have storage info"),e.map(function(e){return m(Z,{storageInfo:e})})})}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){return console.log(e)}):console.log("All files has to be images"))}catch(e){return Promise.reject(e)}},T=function(e){e.preventDefault(),v(Array.from(e.target.files))},x=((n={})[Z]=function(){return g.current.click()},n[X]=function(){return y(function(e){var t=window.prompt("Paste the link bellow:");if(t){var n=window.prompt("Paste the link-text below:");if(n){var r=e.getCurrentContent();r.createEntity(X,"MUTABLE",{href:t,linkText:n});var o=r.getLastCreatedEntityKey(),i=e.getSelection(),a=b.replaceText(r,i,n,null,o),l=i.set("anchorOffset",i.getAnchorOffset()+n.length),s=k.set(e,{currentContent:a},"create-entity"),c=k.forceSelection(s,l);return console.log(l.getAnchorOffset(),"editor selection anchor offset after link insert:",c.getSelection().getAnchorOffset()),c}}}(l))},n[V]=function(){return m(V,{})},n[Q]=function(){},n[$]=function(){m($,{})},n),F=((r={})[Y]=function(e){return y(w.toggleInlineStyle(l,e))},r[J]=function(e){return y(w.toggleBlockType(l,e))},r[W]=function(e){x[e]()},r);return{editorRef:o,editorState:l,computedPosForMentionSuggestions:p,focusedForEditing:u,getFileInputProps:function(){return{ref:g,onChange:T}},generateLink:function(e){try{return Promise.resolve(t.linkGeneratorFn&&"function"==typeof t.linkGeneratorFn?t.linkGeneratorFn(e):null)}catch(e){return Promise.reject(e)}},handleDroppedFiles:function(e,t){return v(t)},handlePastedFiles:function(e){return v(e)},handleEditorStateChange:y,handleKeyCommand:function(e,t){var n=w.handleKeyCommand(t,e);return n?(y(n),"handled"):"not-handled"},handleToolClick:function(e,t){return t.preventDefault(),l.getSelection().getHasFocus()&&null!=e&&e.element?void F[e.element](e.style):null},forceFocusEditorEnd:function(e){var t;(null==e?void 0:e.preventDefault)&&e.preventDefault(),null==(t=o.current.editor)||t.focus(),y(k.moveFocusToEnd(l))},updateComputedPosForMentionSuggestions:function(e){return h(e)},handleMentionSelect:function(e,t,n,r){var o=N.createEmpty(t),i=e.createEntity(Q,"IMMUTABLE",L({},r)),a=i.getLastCreatedEntityKey();i=b.replaceText(e,o.merge({anchorOffset:n.start,focusOffset:n.end}),r.mention,l.getCurrentInlineStyle(),a),y(k.forceSelection(k.moveFocusToEnd(k.set(l,{currentContent:i})),i.getSelectionAfter()))},activateEditor:function(){return d(!0)},deactivateEditor:function(){return d(!1)}}}({handleUpload:r.handleUpload||function(){return Promise.resolve()},linkGeneratorFn:r.linkGeneratorFn,onDataStructureChange:r.onDataStructureChange||function(){},value:r.value||null}),a=L({},(D(o),o));return h(ce.Provider,{value:L({},a,{mentionSuggestions:r.mentionSuggestions||[]})},n)};function de(e){var t;return e.src||e.link?h("img",{src:e.src||e.link,alt:e.alt||(null==(t=e.storageInfo)?void 0:t.Key)||"...",className:"unselectable"}):null}function fe(){return h("hr",null)}function pe(t){return h(e.Fragment,null)}var he=["editorRef","onResizeEnd","reference","currentSize"],ge=[0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100];function me(t){var n,r,o=t.editorRef,i=t.onResizeEnd,a=t.reference,l=void 0===a?"left":a,s=t.currentSize,c=void 0===s?10:s,u=P(t,he),d=e.useState(!1),f=d[0],p=d[1],g=e.useState(c),m=g[0],y=g[1],b=null==(n=o.current)||null==(r=n.editor)?void 0:r.getBoundingClientRect(),k=e.useCallback(function(e){e.preventDefault();var t=function(e){var t=[].concat(ge);p(!0);var n="center"===l?b.width/2:b.width,r=parseInt(Math.abs(e.clientX-("center"===l?b.left+b.width/2:"end"===l?b.left+b.width:b.left))),o=parseInt(r/n*100);t.sort(function(e,t){return Math.abs(o-e)-Math.abs(o-t)});var a=t[0];y(a),i&&i({partition:a});var s=u.block.getEntityAt(0);u.contentState.mergeEntityData(s,{size:a})};document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",function e(){p(!1),document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",e,!1)},!1)},[i]);return h(Fragment,null,h("div",{className:"d-inline-block p-2 unselectable",style:{cursor:"col-resize"},onMouseDown:k},h("div",{className:"bg-primary rounded resize-bar"})),f&&h("div",{className:"resize-guides-container position-absolute "},ge.map(function(e){return parseInt(window.getComputedStyle(document.querySelector(".draft-editor-container"),null).getPropertyValue("padding-left")),{percentage:e,pixels:Math.ceil(b.width*e/100)}}).map(function(e){return h("div",{key:e.pixels,className:v("resize-guide position-absolute rounded",{"bg-info":"start"===l&&e.percentage===m||"end"===l&&100-e.percentage===m}),style:{left:e.pixels}})})))}var ye=["editorRef","onAlignmentChange"],ve=[{label:"Align left",style:ee,icon:"fa-solid fa-align-left"},{label:"Align center",style:"center",icon:"fa-solid fa-align-justify"},{label:"Align right",style:"end",icon:"fa-solid fa-align-right"}];function be(e){var n=e.onAlignmentChange,r=P(e,ye),o=t(function(e){var t=e.alignment;n&&n({alignment:t});var o=r.block.getEntityAt(0);r.contentState.mergeEntityData(o,{alignment:t})},[n]);return h("div",{className:"d-inline-block shadow-md rounded mb-1"},ve.map(function(e){return h(l,{title:null==e?void 0:e.label,type:"button",className:v("btn btn-icon m-0 text-muted",{}),key:null==e?void 0:e.style,onClick:function(t){return o({alignment:null==e?void 0:e.style})}},e.icon?h("i",{className:e.icon}):null==e?void 0:e.label)}))}var ke=["children"];function Te(t){var n=t.children,r=P(t,ke),o=e.useState(!1),i=o[0],a=o[1],l=e.useState(r.size||30),s=l[0],c=l[1],u=e.useState(r.alignment||ee),d=u[0],f=u[1],p=function(){return{"justify-content-start":"start"===d,"justify-content-center":"center"===d,"justify-content-end":"end"===d}};return h(Fragment,null,i&&d&&h("div",{className:v("d-flex",p())},h(be,L({onAlignmentChange:function(e){return f(e.alignment)}},r))),h("div",{className:v("d-flex align-items-center position-relative",p())},i&&"start"!==d&&h(me,L({},r,{reference:d,onResizeEnd:function(e){return c(e.partition)}})),h("div",{className:v("d-inline-block rounded resize-container unselectable",{"resize-focused":i,"w-10":10===s,"w-15":15===s,"w-20":20===s,"w-25":25===s,"w-30":30===s,"w-35":35===s,"w-40":40===s,"w-45":45===s,"w-50":50===s,"w-55":55===s,"w-60":60===s,"w-65":65===s,"w-70":70===s,"w-75":75===s,"w-80":80===s,"w-85":85===s,"w-90":90===s,"w-95":95===s,"w-100":100===s}),onClick:function(){return a(function(e){return!e})}},n),i&&"end"!==d&&h(me,L({},r,{reference:d,currentSize:s,onResizeEnd:function(e){return c(e.partition)}}))))}var Ce=["type","data","editorControllers"];function Se(e){var t=e.type,n=e.data,r=null,o=L({},n,e.editorControllers,P(e,Ce));return t===Z&&(r=h(Te,o,h(de,n))),t===V&&(r=h(fe,n)),t===$&&(r=h(pe,n)),r}var Ee=["generateLink"],we=function(e){return"atomic"===e.getType()?{component:Ie,editable:!1}:null},Ie=function(t){var r,o,i,a,l=t.block.getEntityAt(0),s=l&&t.contentState.getEntity(l),c=null==s?void 0:s.getType(),u=n(ce),d=u.generateLink,f=P(u,Ee),p=(r=L({generateLink:d},null==s?void 0:s.getData()),i=(o=e.useState(r.src))[0],a=o[1],e.useEffect(function(){return function(){try{Promise.resolve(function(){if(!r.src)return function(e,t){try{var n=function(){if(!r.generateLink||"function"!=typeof r.generateLink)throw Error("link gnerator function must be supplied");return Promise.resolve(r.generateLink(r.storageInfo)).then(function(e){if(!e)throw new Error("link generator function must return a valid link or else provide a valid  image source");a(e)})}()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}(0,function(e){a(O),console.log(e)})}())}catch(e){return Promise.reject(e)}}(),function(){}},[r.generateLink]),{link:i});return h(Se,L({type:c,data:L({},null==s?void 0:s.getData(),p),editorControllers:L({},f)},t))},Ne=["readOnly"];function xe(t){var n=t.readOnly,r=void 0!==n&&n,o=P(t,Ne),i=e.useContext(ce);return h(Fragment,null,h(x,{ref:i.editorRef,blockRendererFn:we,placeholder:o.placeholder,onChange:i.handleEditorStateChange,editorState:i.editorState,spellCheck:!0,handleKeyCommand:i.handleKeyCommand,handleDroppedFiles:i.handleDroppedFiles,handlePastedFiles:i.handlePastedFiles,readOnly:r,onFocus:i.activateEditor,onBlur:i.deactivateEditor}))}var Fe={INLINE_TYPES:[{label:"Underline",style:"UNDERLINE",icon:"fa-solid fa-underline",element:Y},{label:"Bold",style:"BOLD",icon:"fa-solid fa-bold",element:Y},{label:"Italic",style:"ITALIC",icon:"fa-solid fa-italic",element:Y},{label:"Strike through",style:"STRIKETHROUGH",icon:"fa-solid fa-strikethrough",element:Y}],BLOCK_TYPES:[{label:"Header",style:"header-three",icon:"fa-solid fa-heading",element:J},{label:"UL",style:"unordered-list-item",icon:"fa-solid fa-list",element:J},{label:"OL",style:"ordered-list-item",icon:"fa-solid fa-list-ol",element:J},{label:"Blockquote",style:"blockquote",icon:"fa-solid fa-quote-left",element:J},{label:"Code block",style:"code-block",icon:"fa-solid fa-code",element:J}],ENTITY_TYPES:[{label:"Image",style:Z,icon:"fa-solid fa-images",element:W},{label:"Divider",style:V,icon:"fa-solid fa-minus",element:W}]};function Oe(e){return h("span",{className:"draft-toolbar-button-separator"},"|")}var Le=e.forwardRef(function(e,t){return h("input",L({},e,{ref:t,className:"d-none",type:"file",accept:e.accept||"image/*"}))});function De(t){var n=e.useContext(ce),r=n.editorState,o=n.handleToolClick;return h(Fragment,null,h(Le,(0,n.getFileInputProps)()),Object.keys(Fe).map(function(t,n){var i;return h(e.Fragment,{key:t},null==(i=Fe[t])?void 0:i.map(function(e){return h(l,{title:null==e?void 0:e.label,className:"btn btn-icon text-muted m-0",key:null==e?void 0:e.style,onMouseDown:function(t){return o(e,t)}},e.icon?h("i",{className:v(e.icon,{"text-primary":r.getCurrentInlineStyle().has(null==e?void 0:e.style)||(null==r?void 0:r.getCurrentContent().getBlockForKey(null==r?void 0:r.getSelection().getStartKey()).getType())===(null==e?void 0:e.style)})}):null==e?void 0:e.label)}),n<Object.keys(Fe).length-1&&h(Oe,null))}))}function Pe(t){var n=e.useContext(ce),r=n.forceFocusEditorEnd;return h("div",{className:v("draft-editor-container d-flex flex-column",{"editor-disabled":t.readOnly,"editor-active":n.focusedForEditing})},!t.readOnly&&h("div",null,h(De,t),h("hr",null)),h(xe,t),h("div",{className:"flex-grow-1",onMouseDown:r}))}function je(e){return h(ue,e,h(Pe,e))}je.propTypes={value:a.string,linkGeneratorFn:a.func,handleUpload:a.func};export{j as Button,R as Card,A as CardBody,M as CardFooter,z as CardHeader,U as Dropdown,G as DropdownItem,_ as DropdownMenu,K as DropdownToggle,H as SimpleTable,je as TextEditor};
//# sourceMappingURL=ims-ui-kit.module.js.map
