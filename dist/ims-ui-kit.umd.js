!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("reactstrap"),require("classnames"),require("draft-js"),require("components/TextEditor/Context"),require("assets/img/default-avatar.png")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","reactstrap","classnames","draft-js","components/TextEditor/Context","assets/img/default-avatar.png"],t):t((e||self).imsUiKit={},e.react,e.propTypes,e.reactstrap,e.classnames,e.draftJs,e.Context,e.defaultAvatar)}(this,function(e,t,n,r,o,a,i,l){function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=/*#__PURE__*/u(t),c=/*#__PURE__*/u(n),d=/*#__PURE__*/u(o),f=/*#__PURE__*/u(l);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(this,arguments)}function g(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function m(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(o[n]=e[n]);return o}Object.assign({leftIcon:"",rightIcon:""},r.Button.prototype.props);var y=function(e){return h(r.Button,e,e.leftIcon?h("i",{className:d.default(e.leftIcon,"me-2")}):null,e.children,e.rightIcon?h("i",{className:d.default(e.rightIcon,"ms-2")}):null)};y.propTypes=p({leftIcon:c.default.string,rightIcon:c.default.string},r.Button.propTypes&&r.Button.propTypes),Object.assign({},r.Card.prototype.props);var v=function(e){return h(r.Card,e,e.children)};v.propTypes=p({},r.Card.propTypes&&r.Card.propTypes),Object.assign({},r.CardBody.prototype.props);var b=function(e){return h(r.CardBody,e,e.children)};b.propTypes=p({},r.CardBody.propTypes&&r.CardBody.propTypes),Object.assign({},r.CardFooter.prototype.props);var C=function(e){return h(r.CardFooter,e,e.children)};C.propTypes=p({},r.CardFooter.propTypes&&r.CardFooter.propTypes),Object.assign({},r.CardHeader.prototype.props);var S=function(e){return h(r.CardHeader,e,e.children)};S.propTypes=p({},r.CardHeader.propTypes&&r.CardHeader.propTypes),Object.assign({},r.Dropdown.prototype.props);var T=function(e){var t=p({},(g(e),e));return h(r.Dropdown,t,t.children)};T.propTypes=p({},r.Dropdown.propTypes&&r.Dropdown.propTypes);var w=["caret"];Object.assign({startIcon:"",endIcon:"",caret:!0},r.DropdownToggle.prototype.props);var E=function(e){var t=m(e,w);return h(Fragment,null,h(r.DropdownToggle,p({caret:!t.startIcon&&!t.endIcon&&t.caret},t),t.startIcon&&h("i",{className:d.default(t.startIcon,"me-2")}),t.children,t.endIcon&&h("i",{className:d.default(t.endIcon,"ms-2")})))};E.propTypes=p({startIcon:c.default.string,endIcon:c.default.string,caret:c.default.bool},r.DropdownToggle.propTypes&&r.DropdownToggle.propTypes),Object.assign({},r.DropdownMenu.prototype.props);var k=function(e){var t=p({},(g(e),e));return h(r.DropdownMenu,t,t.children)};k.propTypes=p({},r.DropdownMenu.propTypes&&r.DropdownMenu.propTypes);var I=["leftIcon","rightIcon","leftIconStyle","rightIconStyle"];Object.assign({},r.DropdownItem.prototype.props);var x=function(e){var t=e.leftIcon,n=void 0===t?"":t,o=e.rightIcon,a=void 0===o?"":o,i=e.leftIconStyle,l=void 0===i?"text-secondary":i,u=e.rightIconStyle,s=void 0===u?"text-secondary":u,c=m(e,I);return h(r.DropdownItem,p({},c,{className:"d-flex justify-content-between align-items-center"}),h("span",null,n&&h("i",{className:n+" "+l+" me-2"}),c.children),a&&h("i",{className:a+" "+s}))};x.propTypes=p({},r.DropdownItem.propTypes&&r.DropdownItem.propTypes);var N=function(e){return h(r.Table,{striped:!0,hover:!0},h("thead",null,h("tr",null,e.thead.map(function(t,n){return h("th",{className:d.default("",{"text-right":e.thead.length-1===n}),key:n},t.text)}))),h("tbody",null,e.tbody.map(function(e,t){var n;return h("tr",{className:d.default((n={},n[e.className]=void 0!==e.className,n)),key:t},e.data.map(function(e,t){var n;return h("td",{className:d.default((n={},n[e.className]=void 0!==e.className,n)),key:t},e.item)}),e.actions&&h("td",{className:"text-right"},e.actions))})))};N.propTypes={thead:c.default.arrayOf(c.default.shape({className:c.default.string,text:c.default.string.isRequired})).isRequired,tbody:c.default.arrayOf(c.default.shape({className:c.default.string,data:c.default.arrayOf(c.default.shape({className:c.default.string,item:c.default.oneOfType([c.default.string,c.default.number,c.default.node]).isRequired})).isRequired,actions:c.default.node})).isRequired};var D="inline-default",F="block-default",O="atomic-entity",R="image",L="divider",j="link",P="mention",B="checklist",M="start";function A(e){var n=e.name,r=e.profileImageUrl,o=e._id,a=e.onSelect,i=void 0===a?function(){}:a,l=t.useCallback(function(e){e.preventDefault(),i({name:n,profileImageUrl:r,_id:o})});return h("div",{className:"d-flex align-items-center"},h("div",{className:"avatar mb-1"},h("img",{src:r||f.default,alt:n})),h("div",{onClick:l,className:"btn btn-link p-2 mb-1"},n))}var U=["suggestions"];function z(e){var n=e.suggestions,r=m(e,U),o=t.useContext(i.TextEditorContext);return h(Fragment,null,n.length?h("div",{className:"mention-suggestions position-absolute mt-4 p-2 shadow-md",style:p({},o.computedPosForMentionSuggestions)},n.map(function(e,t){return h(A,p({key:e.name+t},e,r))})):null)}function K(e,t,n){for(var r,o,a=t.getText();null!==(r=e.exec(a));)n(o=r.index,o+r[0].length)}var q=/\B@\w+/g,_=/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g,H=new a.CompositeDecorator([{strategy:function(e,t,n){K(q,e,t)},component:function(e){var n=t.useRef(null),r=t.useContext(Y),o=r.editorRef,a=r.mentionSuggestions,i=r.updateComputedPosForMentionSuggestions,l=r.handleMentionSelect,u=t.useCallback(function(){var e,t;return{left:(null==(e=o.current)||null==(t=e.editor)?void 0:t.getBoundingClientRect()).width-n.current.offsetLeft<240?n.current.offsetLeft-230:n.current.offsetLeft,top:n.current.offsetTop,display:"block"}},[]),s=t.useCallback(function(){return{display:"none"}},[]);function c(){if(!e.entityKey)return null;var t=e.contentState.getEntity(e.entityKey);return p({},null==t?void 0:t.getData())}return t.useEffect(function(){n.current&&i(u())},[]),h(Fragment,null,c()?h("a",{href:"/admin/users/"+c()._id,className:"text-primary"},c().name):h("span",{ref:n,className:""},e.children),h(z,{suggestions:a.filter(function(t){var n;return t.name.toLowerCase().includes(e.decoratedText.slice(1,null==e||null==(n=e.decoratedText)?void 0:n.length).toLowerCase())}),onSelect:function(t){var n=t.name,r=t.profileImageUrl,o=t._id,a="@"+n.split(" ").join("_");l(e.contentState,e.blockKey,{start:e.start,end:e.end},{mention:a+" ",profileImageUrl:r,_id:o,name:n}),i(s())}}))}},{strategy:function(e,t,n){K(_,e,t)},component:function(e){return h("a",{href:e.decoratedText,title:e.decoratedText,target:"_blank",rel:"noreferrer"},e.children)}},{strategy:function(e,t,n){e.findEntityRanges(function(e){var t=e.getEntity();return null!==t&&n.getEntity(t).getType()===j},t)},component:function(e){var t=e.contentState.getEntity(e.entityKey).getData();return t.href?h("a",{href:t.href,title:t.linkText,target:"_blank",rel:"noreferrer"},t.linkText||t.href):null}}]),G=["children"],Y=s.default.createContext(),J=function(e){var n=e.children,r=m(e,G),o=function(e){var n,r,o=s.default.useRef(null),i=s.default.useState(a.EditorState.createEmpty(H)),l=i[0],u=i[1],c=t.useState(!1),d=c[0],f=c[1],g=s.default.useState({display:"none"}),h=g[0],m=g[1];s.default.useEffect(function(){var t;try{"string"==typeof e.value&&(t=JSON.parse(e.value)),"object"==typeof e.value&&(t=e.value)}catch(t){if(console.log(t),"string"==typeof e.value)return b(a.EditorState.createWithContent(a.ContentState.createFromText(e.value)))}return b(e.value||t?a.EditorState.set(l,{currentContent:a.convertFromRaw(t),directionMap:a.EditorState.createWithContent(a.convertFromRaw(t)).getDirectionMap()}):a.EditorState.createEmpty(H))},[e.value]);var y=s.default.useRef(null),v=function(e,t){var n=l.getCurrentContent().createEntity(e,"IMMUTABLE",p({},t)),r=n.getLastCreatedEntityKey(),o=a.EditorState.set(l,{currentContent:n},"create-entity");b(a.AtomicBlockUtils.insertAtomicBlock(o,r," "))},b=function(t){var n=t.getCurrentContent();u(t),e.onDataStructureChange(JSON.stringify(a.convertToRaw(n)))},C=function(t){try{if(!e.handleUpload)return Promise.resolve(console.log("Uploader function not specified"));var n=t.every(function(e){return"image"===e.type.split("/")[0]});return Promise.resolve(n?function(n,r){try{var o=Promise.resolve(Promise.all(t.map(function(t){return e.handleUpload(t)}))).then(function(e){console.log(e),e.every(function(e){return e})||console.log("one or mutiple files don't have storage info"),e.map(function(e){return v(R,{storageInfo:e})})})}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){return console.log(e)}):console.log("All files has to be images"))}catch(e){return Promise.reject(e)}},S=function(e){e.preventDefault(),C(Array.from(e.target.files))},T=((n={})[R]=function(){return y.current.click()},n[j]=function(){return b(function(e){var t=window.prompt("Paste the link bellow:");if(t){var n=window.prompt("Paste the link-text below:");if(n){var r=e.getCurrentContent();r.createEntity(j,"MUTABLE",{href:t,linkText:n});var o=r.getLastCreatedEntityKey(),i=e.getSelection(),l=a.Modifier.replaceText(r,i,n,null,o),u=i.set("anchorOffset",i.getAnchorOffset()+n.length),s=a.EditorState.set(e,{currentContent:l},"create-entity"),c=a.EditorState.forceSelection(s,u);return console.log(u.getAnchorOffset(),"editor selection anchor offset after link insert:",c.getSelection().getAnchorOffset()),c}}}(l))},n[L]=function(){return v(L,{})},n[P]=function(){},n[B]=function(){v(B,{})},n),w=((r={})[D]=function(e){return b(a.RichUtils.toggleInlineStyle(l,e))},r[F]=function(e){return b(a.RichUtils.toggleBlockType(l,e))},r[O]=function(e){T[e]()},r);return{editorRef:o,editorState:l,computedPosForMentionSuggestions:h,focusedForEditing:d,getFileInputProps:function(){return{ref:y,onChange:S}},generateLink:function(t){try{return Promise.resolve(e.linkGeneratorFn&&"function"==typeof e.linkGeneratorFn?e.linkGeneratorFn(t):null)}catch(e){return Promise.reject(e)}},handleDroppedFiles:function(e,t){return C(t)},handlePastedFiles:function(e){return C(e)},handleEditorStateChange:b,handleKeyCommand:function(e,t){var n=a.RichUtils.handleKeyCommand(t,e);return n?(b(n),"handled"):"not-handled"},handleToolClick:function(e,t){return t.preventDefault(),l.getSelection().getHasFocus()&&null!=e&&e.element?void w[e.element](e.style):null},forceFocusEditorEnd:function(e){var t;(null==e?void 0:e.preventDefault)&&e.preventDefault(),null==(t=o.current.editor)||t.focus(),b(a.EditorState.moveFocusToEnd(l))},updateComputedPosForMentionSuggestions:function(e){return m(e)},handleMentionSelect:function(e,t,n,r){var o=a.SelectionState.createEmpty(t),i=e.createEntity(P,"IMMUTABLE",p({},r)),u=i.getLastCreatedEntityKey();i=a.Modifier.replaceText(e,o.merge({anchorOffset:n.start,focusOffset:n.end}),r.mention,l.getCurrentInlineStyle(),u),b(a.EditorState.forceSelection(a.EditorState.moveFocusToEnd(a.EditorState.set(l,{currentContent:i})),i.getSelectionAfter()))},activateEditor:function(){return f(!0)},deactivateEditor:function(){return f(!1)}}}({handleUpload:r.handleUpload||function(){return Promise.resolve()},linkGeneratorFn:r.linkGeneratorFn,onDataStructureChange:r.onDataStructureChange||function(){},value:r.value||null}),i=p({},(g(o),o));return h(Y.Provider,{value:p({},i,{mentionSuggestions:r.mentionSuggestions||[]})},n)};function W(e){var t;return e.src||e.link?h("img",{src:e.src||e.link,alt:e.alt||(null==(t=e.storageInfo)?void 0:t.Key)||"...",className:"unselectable"}):null}function Z(){return h("hr",null)}function V(e){return h(s.default.Fragment,null)}var X=["editorRef","onResizeEnd","reference","currentSize"],Q=[0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100];function $(e){var t,n,r=e.editorRef,o=e.onResizeEnd,a=e.reference,i=void 0===a?"left":a,l=e.currentSize,u=void 0===l?10:l,c=m(e,X),f=s.default.useState(!1),p=f[0],g=f[1],y=s.default.useState(u),v=y[0],b=y[1],C=null==(t=r.current)||null==(n=t.editor)?void 0:n.getBoundingClientRect(),S=s.default.useCallback(function(e){e.preventDefault();var t=function(e){var t=[].concat(Q);g(!0);var n="center"===i?C.width/2:C.width,r=parseInt(Math.abs(e.clientX-("center"===i?C.left+C.width/2:"end"===i?C.left+C.width:C.left))),a=parseInt(r/n*100);t.sort(function(e,t){return Math.abs(a-e)-Math.abs(a-t)});var l=t[0];b(l),o&&o({partition:l});var u=c.block.getEntityAt(0);c.contentState.mergeEntityData(u,{size:l})};document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",function e(){g(!1),document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",e,!1)},!1)},[o]);return h(Fragment,null,h("div",{className:"d-inline-block p-2 unselectable",style:{cursor:"col-resize"},onMouseDown:S},h("div",{className:"bg-primary rounded resize-bar"})),p&&h("div",{className:"resize-guides-container position-absolute "},Q.map(function(e){return parseInt(window.getComputedStyle(document.querySelector(".draft-editor-container"),null).getPropertyValue("padding-left")),{percentage:e,pixels:Math.ceil(C.width*e/100)}}).map(function(e){return h("div",{key:e.pixels,className:d.default("resize-guide position-absolute rounded",{"bg-info":"start"===i&&e.percentage===v||"end"===i&&100-e.percentage===v}),style:{left:e.pixels}})})))}var ee=["editorRef","onAlignmentChange"],te=[{label:"Align left",style:M,icon:"fa-solid fa-align-left"},{label:"Align center",style:"center",icon:"fa-solid fa-align-justify"},{label:"Align right",style:"end",icon:"fa-solid fa-align-right"}];function ne(e){var n=e.onAlignmentChange,o=m(e,ee),a=t.useCallback(function(e){var t=e.alignment;n&&n({alignment:t});var r=o.block.getEntityAt(0);o.contentState.mergeEntityData(r,{alignment:t})},[n]);return h("div",{className:"d-inline-block shadow-md rounded mb-1"},te.map(function(e){return h(r.Button,{title:null==e?void 0:e.label,type:"button",className:d.default("btn btn-icon m-0 text-muted",{}),key:null==e?void 0:e.style,onClick:function(t){return a({alignment:null==e?void 0:e.style})}},e.icon?h("i",{className:e.icon}):null==e?void 0:e.label)}))}var re=["children"];function oe(e){var t=e.children,n=m(e,re),r=s.default.useState(!1),o=r[0],a=r[1],i=s.default.useState(n.size||30),l=i[0],u=i[1],c=s.default.useState(n.alignment||M),f=c[0],g=c[1],y=function(){return{"justify-content-start":"start"===f,"justify-content-center":"center"===f,"justify-content-end":"end"===f}};return h(Fragment,null,o&&f&&h("div",{className:d.default("d-flex",y())},h(ne,p({onAlignmentChange:function(e){return g(e.alignment)}},n))),h("div",{className:d.default("d-flex align-items-center position-relative",y())},o&&"start"!==f&&h($,p({},n,{reference:f,onResizeEnd:function(e){return u(e.partition)}})),h("div",{className:d.default("d-inline-block rounded resize-container unselectable",{"resize-focused":o,"w-10":10===l,"w-15":15===l,"w-20":20===l,"w-25":25===l,"w-30":30===l,"w-35":35===l,"w-40":40===l,"w-45":45===l,"w-50":50===l,"w-55":55===l,"w-60":60===l,"w-65":65===l,"w-70":70===l,"w-75":75===l,"w-80":80===l,"w-85":85===l,"w-90":90===l,"w-95":95===l,"w-100":100===l}),onClick:function(){return a(function(e){return!e})}},t),o&&"end"!==f&&h($,p({},n,{reference:f,currentSize:l,onResizeEnd:function(e){return u(e.partition)}}))))}var ae=["type","data","editorControllers"];function ie(e){var t=e.type,n=e.data,r=null,o=p({},n,e.editorControllers,m(e,ae));return t===R&&(r=h(oe,o,h(W,n))),t===L&&(r=h(Z,n)),t===B&&(r=h(V,n)),r}var le=["generateLink"],ue=function(e){return"atomic"===e.getType()?{component:se,editable:!1}:null},se=function(e){var n,r,o,a,i=e.block.getEntityAt(0),l=i&&e.contentState.getEntity(i),u=null==l?void 0:l.getType(),c=t.useContext(Y),d=c.generateLink,g=m(c,le),y=(n=p({generateLink:d},null==l?void 0:l.getData()),o=(r=s.default.useState(n.src))[0],a=r[1],s.default.useEffect(function(){return function(){try{Promise.resolve(function(){if(!n.src)return function(e,t){try{var r=function(){if(!n.generateLink||"function"!=typeof n.generateLink)throw Error("link gnerator function must be supplied");return Promise.resolve(n.generateLink(n.storageInfo)).then(function(e){if(!e)throw new Error("link generator function must return a valid link or else provide a valid  image source");a(e)})}()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(0,function(e){a(f.default),console.log(e)})}())}catch(e){return Promise.reject(e)}}(),function(){}},[n.generateLink]),{link:o});return h(ie,p({type:u,data:p({},null==l?void 0:l.getData(),y),editorControllers:p({},g)},e))},ce=["readOnly"];function de(e){var t=e.readOnly,n=void 0!==t&&t,r=m(e,ce),o=s.default.useContext(Y);return h(Fragment,null,h(a.Editor,{ref:o.editorRef,blockRendererFn:ue,placeholder:r.placeholder,onChange:o.handleEditorStateChange,editorState:o.editorState,spellCheck:!0,handleKeyCommand:o.handleKeyCommand,handleDroppedFiles:o.handleDroppedFiles,handlePastedFiles:o.handlePastedFiles,readOnly:n,onFocus:o.activateEditor,onBlur:o.deactivateEditor}))}var fe={INLINE_TYPES:[{label:"Underline",style:"UNDERLINE",icon:"fa-solid fa-underline",element:D},{label:"Bold",style:"BOLD",icon:"fa-solid fa-bold",element:D},{label:"Italic",style:"ITALIC",icon:"fa-solid fa-italic",element:D},{label:"Strike through",style:"STRIKETHROUGH",icon:"fa-solid fa-strikethrough",element:D}],BLOCK_TYPES:[{label:"Header",style:"header-three",icon:"fa-solid fa-heading",element:F},{label:"UL",style:"unordered-list-item",icon:"fa-solid fa-list",element:F},{label:"OL",style:"ordered-list-item",icon:"fa-solid fa-list-ol",element:F},{label:"Blockquote",style:"blockquote",icon:"fa-solid fa-quote-left",element:F},{label:"Code block",style:"code-block",icon:"fa-solid fa-code",element:F}],ENTITY_TYPES:[{label:"Image",style:R,icon:"fa-solid fa-images",element:O},{label:"Divider",style:L,icon:"fa-solid fa-minus",element:O}]};function pe(e){return h("span",{className:"draft-toolbar-button-separator"},"|")}var ge=s.default.forwardRef(function(e,t){return h("input",p({},e,{ref:t,className:"d-none",type:"file",accept:e.accept||"image/*"}))});function he(e){var t=s.default.useContext(Y),n=t.editorState,o=t.handleToolClick;return h(Fragment,null,h(ge,(0,t.getFileInputProps)()),Object.keys(fe).map(function(e,t){var a;return h(s.default.Fragment,{key:e},null==(a=fe[e])?void 0:a.map(function(e){return h(r.Button,{title:null==e?void 0:e.label,className:"btn btn-icon text-muted m-0",key:null==e?void 0:e.style,onMouseDown:function(t){return o(e,t)}},e.icon?h("i",{className:d.default(e.icon,{"text-primary":n.getCurrentInlineStyle().has(null==e?void 0:e.style)||(null==n?void 0:n.getCurrentContent().getBlockForKey(null==n?void 0:n.getSelection().getStartKey()).getType())===(null==e?void 0:e.style)})}):null==e?void 0:e.label)}),t<Object.keys(fe).length-1&&h(pe,null))}))}function me(e){var t=s.default.useContext(Y),n=t.forceFocusEditorEnd;return h("div",{className:d.default("draft-editor-container d-flex flex-column",{"editor-disabled":e.readOnly,"editor-active":t.focusedForEditing})},!e.readOnly&&h("div",null,h(he,e),h("hr",null)),h(de,e),h("div",{className:"flex-grow-1",onMouseDown:n}))}function ye(e){return h(J,e,h(me,e))}ye.propTypes={value:c.default.string,linkGeneratorFn:c.default.func,handleUpload:c.default.func},e.Button=y,e.Card=v,e.CardBody=b,e.CardFooter=C,e.CardHeader=S,e.Dropdown=T,e.DropdownItem=x,e.DropdownMenu=k,e.DropdownToggle=E,e.SimpleTable=N,e.TextEditor=ye});
//# sourceMappingURL=ims-ui-kit.umd.js.map
